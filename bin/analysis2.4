#!/usr/bin/env bash

export VERSION_PATH=ccpnmr2.4
export CCPNMR_TOP_DIR="$(cd "$(dirname "$0")/.." || exit; pwd)"
export ANACONDA3="${CCPNMR_TOP_DIR}"/miniconda
export PYTHONPATH="${CCPNMR_TOP_DIR}/${VERSION_PATH}/python:${CCPNMR_TOP_DIR}/${VERSION_PATH}/python"
export PATH=${ANACONDA3}/lib/site-packages/numpy/.libs:${ANACONDA3}:${ANACONDA3}/Library/mingw-w64/bin:${ANACONDA3}/Library/usr/bin:${ANACONDA3}/Library/bin:${ANACONDA3}/Scripts:${ANACONDA3}/bin:${CCPNMR_TOP_DIR}/bin:${PATH}

UNAME="$(uname -s)"
if [[ ${UNAME} == 'Darwin' ]]; then
  export DYLD_FALLBACK_LIBRARY_PATH=/System/Library/Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ImageIO.framework/Versions/A/Resources:
  export DYLD_FALLBACK_LIBRARY_PATH=${DYLD_FALLBACK_LIBRARY_PATH}"${ANACONDA3}"/lib:
  export DYLD_FALLBACK_LIBRARY_PATH=${DYLD_FALLBACK_LIBRARY_PATH}${HOME}/lib:/usr/local/lib:/usr/lib:
fi

ANALYSIS="${CCPNMR_TOP_DIR}"/ccpnmr2.4/python/ccpnmr/analysis/AnalysisGui.py
if [[ ${UNAME} == *"Win"* || ${UNAME} == *"MING"* ]]; then
  echo "Please use the scripts in the 'bat' directory"
else
  "${ANACONDA3}"/bin/python -i -O -W ignore::DeprecationWarning "${ANALYSIS}" $*
fi
